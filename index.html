<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
  <title>한글 버튼</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#d9d9db">

  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("sw.js");
      });
    }
  </script>

  <style>
    :root{
      --bg:#d9d9db;
      --panel:#d9d9db;
      --key:#ffffff;
      --keyText:#121212;
      --keyShadow1: rgba(0,0,0,0.12);
      --keyShadow2: rgba(0,0,0,0.08);
      --border: rgba(0,0,0,0.06);
      --barBtn:#f2f2f3;
      --barBtnText:#111;
      --barBox:#ffffff;
      --barBoxText:#111;
    }

    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    html,body{
      margin:0;
      height:100%;
      background:var(--bg);
      font-family:system-ui,-apple-system,"Noto Sans KR",sans-serif;
    }

    body{ padding-bottom:1px; }

    .app{
      height:100vh;
      display:flex;
      flex-direction:column;
    }

    .stage{
      flex:1;
      padding:10px;
      display:flex;
    }

    .grid{
      flex:1;
      display:grid;
      gap:12px;
    }

    .grid.consonant{
      grid-template-columns:repeat(7,1fr);
      grid-template-rows:repeat(2,1fr);
    }

    .grid.vowel{
      grid-template-columns:repeat(7,1fr);
      grid-template-rows:repeat(3,1fr);
    }

    .key{
      border:1px solid var(--border);
      border-radius:18px;
      background:var(--key);
      color:var(--keyText);
      font-weight:900;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 6px 12px var(--keyShadow1),0 1px 0 var(--keyShadow2);
      user-select:none;
    }

    .bottom{
      background:var(--panel);
      padding:6px 10px 10px;
    }

    .row-top{
      display:flex;
      gap:10px;
      height:44px;
    }

    .small-btn{
      border-radius:14px;
      background:var(--barBtn);
      font-weight:900;
      padding:8px 12px;
    }

    .selected{
      flex:1;
      background:var(--barBox);
      border-radius:14px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:26px;
      font-weight:900;
    }

    .row-output{
      margin-top:8px;
      height:46px;
      background:var(--barBox);
      border-radius:14px;
      padding:6px 10px;
      font-size:clamp(18px,4vw,32px);
      font-weight:900;
      white-space:nowrap;
      overflow:hidden;
    }
  </style>
</head>

<body>
<div class="app">
  <div class="stage" id="stage"></div>

  <div class="bottom">
    <div class="row-top">
      <button class="small-btn" id="backBtn">←</button>
      <button class="small-btn" id="delBtn">⌫</button>
      <button class="small-btn" id="clearBtn">지움</button>
      <div class="selected" id="selected"></div>
    </div>
    <div class="row-output" id="output"></div>
  </div>
</div>

<script>
const consonants=["ㄱ","ㄴ","ㄷ","ㄹ","ㅁ","ㅂ","ㅅ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
const vowels=["ㅏ","ㅐ","ㅑ","ㅒ","ㅓ","ㅔ","ㅕ","ㅖ","ㅗ","ㅘ","ㅙ","ㅚ","ㅛ","ㅜ","ㅝ","ㅞ","ㅟ","ㅠ","ㅡ","ㅢ","ㅣ"];
const choseong=["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];

let screen="c";
let pending="";
let text="";

const stage=document.getElementById("stage");
const sel=document.getElementById("selected");
const out=document.getElementById("output");

function compose(c,v){
  return String.fromCharCode(0xAC00+(choseong.indexOf(c)*21+vowels.indexOf(v))*28);
}

function render(){
  stage.innerHTML="";
  sel.textContent=pending;
  out.textContent=text;

  const grid=document.createElement("div");
  grid.className="grid "+(screen==="c"?"consonant":"vowel");

  (screen==="c"?consonants:vowels).forEach(ch=>{
    const b=document.createElement("div");
    b.className="key";
    b.textContent=ch;
    b.onclick=()=>{
      if(screen==="c"){pending=ch;screen="v";}
      else{text+=compose(pending,ch);pending="";screen="c";}
      render();
    };
    grid.appendChild(b);
  });

  stage.appendChild(grid);
}

document.getElementById("backBtn").onclick=()=>{pending="";screen="c";render();};
document.getElementById("delBtn").onclick=()=>{text=[...text].slice(0,-1).join("");render();};
document.getElementById("clearBtn").onclick=()=>{text="";pending="";render();};

render();
</script>
</body>
</html>
